# https://www.archlinux.org/packages/community/x86_64/python-psutil
pkgname=python-psutil
_name=${pkgname#python-}
pkgver=5.7.0
pkgrel=1
pkgdesc="A cross-platform process and system utilities module for Python"
arch=('x86_64')
url="https://github.com/giampaolo/psutil"
license=('custom: BSD')
depends=('python')
makedepends=('python-setuptools')
checkdepends=('net-tools' 'procps-ng' 'python-mock' 'python-pytest')
source=("https://pypi.org/packages/source/${_name:0:1}/$_name/$_name-$pkgver.tar.gz")
sha256sums=('685ec16ca14d079455892f25bd124df26ff9137664af445563c1bd36629b5e0e')

build() {
	cd "$_name-$pkgver"
	python setup.py build --build-lib=build/python
}

check() {
	cd "$_name-$pkgver"

	# Required for testing
#	cp setup.py build/python
#	cp -r scripts build/python/

	# 4 non-working tests in build chroot, requires fixes. Test framework does not allow exclusion.
#	PYTHONPATH="$PWD/build/python" python psutil/tests/__main__.py
}

package() {
	cd "$_name-$pkgver"
	python setup.py build --build-lib=build/python install --root="$pkgdir" --optimize=1

	install -Dm644 LICENSE -t "$pkgdir/usr/share/licenses/$pkgname"
}
