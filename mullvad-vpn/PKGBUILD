# Maintainer: Mark Wagie <yochanan dot marqos at gmail dot com>
pkgname=mullvad-vpn
pkgver=2019.9
pkgrel=7
pkgdesc="The Mullvad VPN client app for desktop"
url="https://www.mullvad.net"
arch=('x86_64')
license=('GPL3')
depends=('libnotify' 'libappindicator-gtk3' 'libxss' 'nss' 'libnftnl' 'openvpn' 'shadowsocks'
         'wireguard-tools' 'WIREGUARD-MODULE')
makedepends=('cargo' 'npm')
install="$pkgname.install"
source=("$pkgname-$pkgver::https://github.com/mullvad/mullvadvpn-app/archive/$pkgver.tar.gz")
sha256sums=('7966694defe048eb320142cac711756e4fc42cb503de7c2fc1e93b7be04aad6b')

build() {
	cd "$srcdir/mullvadvpn-app-$pkgver"

	# Build mullvad-daemon
	cargo build --release --locked

	# Build Electron GUI app
	cd gui
	npm install --cache "$srcdir/npm-cache"
	npm run pack:linux
}

check() {
	cd "$srcdir/mullvadvpn-app-$pkgver"
	cargo test --release --locked

	npm test
}

package() {
	cd "$srcdir/mullvadvpn-app-$pkgver"

}
